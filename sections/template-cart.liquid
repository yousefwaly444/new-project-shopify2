{% if section.settings.recommendations_collection != blank %}
  {% assign rec_collection = section.settings.recommendations_collection %}
{% else %}
  {% assign rec_collection = collections.frontpage %}
{% endif %}

<style>
  .cart-item-card { background: #fff; border-radius: 16px; border: 1px solid #f0f0f0; box-shadow: 0 1px 4px rgba(0,0,0,0.06); overflow: hidden; }
  .qty-btn { width: 32px; height: 32px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; font-size: 1.1rem; line-height: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #374151; transition: background 0.15s; }
  .qty-btn:hover { background: #f3f4f6; }
  .qty-input { width: 40px; text-align: center; border: none; font-size: 0.95rem; font-weight: 600; color: #111; background: transparent; outline: none; }
  input[type=number]::-webkit-outer-spin-button,
  input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  input[type=number] { -moz-appearance: textfield; }
  .remove-btn { width: 28px; height: 28px; border-radius: 50%; background: #ef4444; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: background 0.15s; }
  .remove-btn:hover { background: #dc2626; }
  .rec-card { border: 1px solid #f0f0f0; border-radius: 12px; overflow: hidden; background: #fff; display: flex; flex-direction: column; }
  .rec-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
  .order-summary-card { background: #fff; border-radius: 16px; border: 1px solid #f0f0f0; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
  .divider { border: none; border-top: 1px solid #f0f0f0; margin: 0; }
</style>

<div class="max-w-lg mx-auto px-4 py-8">
  {% if cart.item_count == 0 %}
    <div class="order-summary-card px-6 py-16 text-center">
      <div class="w-16 h-16 mx-auto mb-5 rounded-full bg-gray-100 flex items-center justify-center">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg>
      </div>
      <h2 class="text-xl font-bold text-gray-900 mb-2">Your cart is empty</h2>
      <p class="text-gray-500 mb-8 text-sm">Add products to your cart to see them here.</p>
      <a href="{{ routes.root_url }}" class="inline-block px-8 py-3 bg-gray-900 text-white font-semibold rounded-xl hover:bg-gray-800 transition-colors">Continue shopping</a>
    </div>

  {% else %}
    <div class="space-y-4">

      <!-- Cart items -->
      <form action="{{ routes.cart_url }}" method="post" id="cart-form">
        {% for item in cart.items %}
          <div class="cart-item-card p-4">
            <!-- Top row: image + details + remove -->
            <div class="flex items-start gap-3">
              <a href="{{ item.url }}" class="shrink-0 w-20 h-20 rounded-xl overflow-hidden bg-gray-50">
                {% if item.image %}
                  <img src="{{ item.image | image_url: width: 160, height: 160 }}" alt="{{ item.title | escape }}" width="80" height="80" class="w-full h-full object-cover">
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
                {% endif %}
              </a>
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2">
                  <a href="{{ item.url }}" class="font-semibold text-gray-900 text-sm leading-snug hover:text-gray-600 transition-colors line-clamp-2">{{ item.product.title }}</a>
                  <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity=0" class="remove-btn shrink-0 ml-1" aria-label="Remove {{ item.product.title }}">
                    <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </a>
                </div>
                {% if item.variant.title != 'Default Title' %}
                  <p class="text-xs text-gray-500 mt-0.5">{{ item.variant.title }}</p>
                {% endif %}
                <div class="flex items-center gap-2 mt-1.5 flex-wrap">
                  {% if item.original_price > item.final_price %}
                    <span class="text-xs text-gray-400 line-through">{{ item.original_price | money }}</span>
                  {% endif %}
                  <span class="text-sm font-bold text-gray-900">{{ item.final_price | money }}</span>
                </div>
              </div>
            </div>
            <!-- Bottom row: qty + total -->
            <div class="flex items-center justify-between mt-4 pt-3 border-t border-gray-100">
              <div class="flex items-center gap-2">
                <label for="qty-{{ forloop.index }}" class="sr-only">Quantity</label>
                <button type="button" class="cart-qty-minus qty-btn" data-line="{{ forloop.index }}" aria-label="Decrease">âˆ’</button>
                <input type="number" name="updates[]" id="qty-{{ forloop.index }}" value="{{ item.quantity }}" min="0" class="qty-input">
                <button type="button" class="cart-qty-plus qty-btn" data-line="{{ forloop.index }}" aria-label="Increase">+</button>
              </div>
              <span class="text-sm font-semibold text-gray-700">Total: {{ item.final_line_price | money }}</span>
            </div>
          </div>
        {% endfor %}
      </form>

      <!-- Recommendations -->
      {% if rec_collection.products.size > 0 %}
        <div class="order-summary-card p-5">
          <h2 class="text-base font-bold text-gray-900 mb-4">Great choices before completing your order</h2>
          <div class="grid grid-cols-2 gap-3">
            {% for product in rec_collection.products limit: 4 %}
              <div class="rec-card">
                <a href="{{ product.url }}" class="block aspect-square bg-gray-50">
                  {% if product.featured_image %}
                    <img src="{{ product.featured_image | image_url: width: 300, height: 300 }}" alt="{{ product.featured_image.alt | escape }}" width="150" height="150" class="w-full h-full object-cover">
                  {% else %}
                    {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
                  {% endif %}
                </a>
                <div class="p-3 flex flex-col flex-1">
                  <a href="{{ product.url }}" class="text-sm font-medium text-gray-900 line-clamp-2 hover:text-gray-600 mb-1">{{ product.title }}</a>
                  <div class="flex items-center gap-1.5 flex-wrap mb-3">
                    <span class="text-sm font-bold text-gray-900">{{ product.price | money }}</span>
                    {% if product.compare_at_price > product.price %}
                      <span class="text-xs text-gray-400 line-through">{{ product.compare_at_price | money }}</span>
                    {% endif %}
                  </div>
                  {% if product.available %}
                    <button type="button" class="add-to-cart-btn w-full py-2 bg-gray-900 text-white text-xs font-semibold rounded-lg hover:bg-gray-800 transition-colors mt-auto" data-variant-id="{{ product.selected_or_first_available_variant.id }}">Add to cart</button>
                  {% else %}
                    <span class="w-full py-2 text-center text-xs text-gray-400 bg-gray-100 rounded-lg mt-auto">Sold out</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <!-- Order Summary -->
      <div class="order-summary-card overflow-hidden">
        <div class="p-5">
          <h2 class="text-base font-bold text-gray-900">Order Summary</h2>
        </div>
        <hr class="divider">
        <div class="p-5 flex justify-between items-center">
          <span class="text-sm text-gray-600">Total items amount</span>
          <span class="text-sm font-semibold text-gray-900">{{ cart.total_price | money }}</span>
        </div>
        <hr class="divider">
        <div class="p-5">
          <p class="text-sm font-medium text-gray-700 mb-3">Do you have a promo code?</p>
          <form action="{{ routes.cart_url }}" method="post" class="flex gap-2">
            <input type="text" name="checkout[coupon]" placeholder="Apply Coupon" class="flex-1 px-3 py-2.5 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent">
            <button type="submit" class="px-4 py-2.5 bg-gray-900 text-white text-sm font-semibold rounded-xl hover:bg-gray-800 transition-colors whitespace-nowrap">Apply</button>
          </form>
        </div>
        <hr class="divider">
        <div class="p-5 flex justify-between items-center">
          <span class="text-sm font-semibold text-gray-900">Final total amount</span>
          <span class="text-lg font-bold text-gray-900">{{ cart.total_price | money }}</span>
        </div>
        <hr class="divider">
        <div class="p-5">
          <form action="{{ routes.cart_url }}" method="post">
            <button type="submit" name="checkout" class="w-full py-4 bg-gray-900 text-white font-bold rounded-xl hover:bg-gray-800 transition-colors text-base">Submit order</button>
          </form>
        </div>
      </div>

    </div>
  {% endif %}
</div>

<script>
document.querySelectorAll('.cart-qty-minus').forEach(function(btn) {
  btn.addEventListener('click', function() {
    var input = document.getElementById('qty-' + this.dataset.line);
    if (!input) return;
    var val = parseInt(input.value, 10) || 0;
    if (val > 0) { input.value = val - 1; document.getElementById('cart-form').submit(); }
  });
});
document.querySelectorAll('.cart-qty-plus').forEach(function(btn) {
  btn.addEventListener('click', function() {
    var input = document.getElementById('qty-' + this.dataset.line);
    if (!input) return;
    var val = parseInt(input.value, 10) || 0;
    input.value = val + 1; document.getElementById('cart-form').submit();
  });
});
</script>

{% schema %}
{
  "name": "Template Cart",
  "settings": [
    {
      "type": "collection",
      "id": "recommendations_collection",
      "label": "Recommendations collection",
      "info": "Products shown in \"Great choices before completing your order\". Leave blank to use the frontpage collection."
    }
  ]
}
{% endschema %}
