<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap">

<style>
  .lux-search {
    max-width: 800px;
    margin: 0 auto;
    padding: 48px 20px 80px;
    font-family: 'Inter', -apple-system, sans-serif;
  }

  /* Search Form */
  .lux-search__form-wrap {
    position: relative;
    z-index: 40;
    margin-bottom: 48px;
  }

  .lux-search__box {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 24px;
    border-radius: 30px;
    background: rgba(255, 255, 255, {{ section.settings.bg_opacity }});
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    position: relative;
    transition: box-shadow 0.4s ease;
  }

  .lux-search__box::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 30px;
    padding: 1.5px;
    background: linear-gradient(135deg, {{ section.settings.border_color }}, #E5C87A, {{ section.settings.border_color }});
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    opacity: 0.6;
    transition: opacity 0.4s ease;
  }

  .lux-search__box:hover::before {
    opacity: 1;
  }

  .lux-search__box:focus-within {
    box-shadow: 0 8px 30px rgba(0,0,0,0.08), 0 0 0 3px rgba(198, 167, 94, 0.15);
  }

  {% if section.settings.enable_animation %}
  .lux-search__box:focus-within::before {
    background: linear-gradient(90deg, {{ section.settings.border_color }}, #f9e5a5, {{ section.settings.border_color }});
    background-size: 200% 100%;
    animation: lux-shimmer 2.5s linear infinite;
    opacity: 1;
  }
  @keyframes lux-shimmer {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
  }
  {% endif %}

  .lux-search__icon {
    width: 20px;
    height: 20px;
    color: {{ section.settings.border_color }};
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .lux-search__box:focus-within .lux-search__icon {
    transform: scale(1.1);
  }

  .lux-search__input {
    flex: 1;
    min-width: 0;
    border: none;
    background: transparent;
    outline: none;
    font-family: 'Inter', sans-serif;
    font-size: 16px;
    font-weight: 300;
    color: #111;
    letter-spacing: 0.01em;
  }

  .lux-search__input::placeholder {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-weight: 400;
    color: #999;
    transition: opacity 0.3s;
  }

  .lux-search__input:focus::placeholder { opacity: 0.4; }

  .lux-search__clear {
    display: none;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background: #f0f0f0;
    cursor: pointer;
    flex-shrink: 0;
    transition: background 0.2s;
    padding: 0;
  }
  .lux-search__clear:hover { background: #e0e0e0; }
  .lux-search__clear svg { width: 14px; height: 14px; color: #666; }
  .lux-search__clear.is-visible { display: flex; }

  .lux-search__submit {
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    flex-shrink: 0;
  }

  /* Live Results (inline below search bar) */
  .lux-live {
    margin-top: 32px;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.35s ease, transform 0.35s ease;
    display: none;
  }

  .lux-live.is-open {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }

  .lux-live__heading {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 15px;
    color: #999;
    margin-bottom: 20px;
    text-align: center;
  }

  .lux-live__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  @media (min-width: 640px) {
    .lux-live__grid { grid-template-columns: repeat(3, 1fr); gap: 20px; }
  }

  .lux-live__card {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    transition: box-shadow 0.3s, transform 0.3s;
  }
  .lux-live__card:hover {
    box-shadow: 0 8px 30px rgba(0,0,0,0.10);
    transform: translateY(-2px);
  }

  .lux-live__card-img {
    aspect-ratio: 1/1;
    overflow: hidden;
    background: #f5f5f5;
  }
  .lux-live__card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  .lux-live__card:hover .lux-live__card-img img {
    transform: scale(1.05);
  }

  .lux-live__card-body {
    padding: 14px 16px;
  }

  .lux-live__card-title {
    font-size: 13px;
    font-weight: 500;
    color: #222;
    line-height: 1.4;
    margin-bottom: 6px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .lux-live__card-price {
    font-size: 14px;
    font-weight: 600;
    color: #111;
  }

  .lux-live__view-all {
    display: block;
    text-align: center;
    margin-top: 24px;
    padding: 14px 32px;
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 15px;
    color: {{ section.settings.border_color }};
    text-decoration: none;
    border: 1.5px solid {{ section.settings.border_color }};
    border-radius: 30px;
    transition: background 0.3s, color 0.3s;
    max-width: 260px;
    margin-left: auto;
    margin-right: auto;
  }
  .lux-live__view-all:hover {
    background: {{ section.settings.border_color }};
    color: #fff;
  }

  .lux-live__status {
    padding: 40px 20px;
    text-align: center;
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 15px;
    color: #999;
  }

  .lux-live__spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid #e0d5c0;
    border-top-color: {{ section.settings.border_color }};
    border-radius: 50%;
    animation: lux-spin 0.6s linear infinite;
    vertical-align: middle;
    margin-right: 10px;
  }
  @keyframes lux-spin {
    to { transform: rotate(360deg); }
  }

  /* Empty State (no search performed) */
  .lux-search__empty {
    text-align: center;
    padding: 60px 20px;
  }

  .lux-search__empty-icon {
    width: 56px;
    height: 56px;
    margin: 0 auto 24px;
    color: #ccc;
  }

  .lux-search__empty-title {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    font-weight: 400;
    color: #333;
    margin-bottom: 10px;
  }

  .lux-search__empty-text {
    font-size: 15px;
    color: #999;
    max-width: 380px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Results Count */
  .lux-search__count {
    text-align: center;
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 18px;
    color: #555;
    margin-bottom: 40px;
  }

  /* Results Grid */
  .lux-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
  }
  @media (min-width: 640px) {
    .lux-grid { grid-template-columns: repeat(3, 1fr); gap: 32px; }
  }

  .lux-grid__card {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
  }

  .lux-grid__img {
    aspect-ratio: 4/5;
    overflow: hidden;
    background: #f7f7f7;
    border-radius: 14px;
    margin-bottom: 16px;
  }

  .lux-grid__img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .lux-grid__card:hover .lux-grid__img img { transform: scale(1.05); }

  .lux-grid__title {
    font-size: 14px;
    font-weight: 400;
    color: #222;
    margin-bottom: 6px;
    line-height: 1.4;
  }

  .lux-grid__price {
    font-size: 14px;
    color: #777;
  }

  /* No Results */
  .lux-search__no-results {
    text-align: center;
    padding: 60px 20px;
  }
  .lux-search__no-results-title {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    color: #222;
    margin-bottom: 10px;
  }
  .lux-search__no-results-text {
    font-size: 15px;
    color: #999;
    line-height: 1.6;
  }

  /* Pagination */
  .lux-search__pagination {
    margin-top: 48px;
    text-align: center;
  }
</style>

<div class="lux-search">

  <!-- Search Bar -->
  <div class="lux-search__form-wrap">
    <form action="{{ routes.search_url }}" method="get" role="search">
      <div class="lux-search__box">
        <svg class="lux-search__icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <input
          type="search"
          name="q"
          id="lux-input"
          class="lux-search__input"
          placeholder="{{ section.settings.placeholder_text }}"
          value="{{ search.terms | escape }}"
          autocomplete="off"
          autofocus
          aria-label="Search"
          aria-controls="lux-predict"
          aria-expanded="false"
        >
        <button type="button" class="lux-search__clear" id="lux-clear" aria-label="Clear search">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <button type="submit" class="lux-search__submit" aria-label="Search">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width:20px;height:20px;color:#111;opacity:0.4;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
          </svg>
        </button>
      </div>
    </form>

    <!-- Live results appear here as you type -->
    <div class="lux-live" id="lux-live" aria-live="polite"></div>
  </div>

  <div id="lux-static-results">
  {% if search.performed %}
    {% if search.results_count > 0 %}
      <p class="lux-search__count">
        {{ search.results_count }} result{% if search.results_count != 1 %}s{% endif %} for "{{ search.terms | escape }}"
      </p>

      {% paginate search.results by 12 %}
        <div class="lux-grid">
          {% for item in search.results %}
            <a href="{{ item.url }}" class="lux-grid__card">
              <div class="lux-grid__img">
                {% if item.featured_image %}
                  <img
                    src="{{ item.featured_image | image_url: width: 600 }}"
                    alt="{{ item.featured_image.alt | default: item.title | escape }}"
                    width="600"
                    height="750"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
                {% endif %}
              </div>
              <div class="lux-grid__title">{{ item.title }}</div>
              {% if item.object_type == 'product' %}
                <div class="lux-grid__price">{{ item.price | money }}</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>

        {% if paginate.pages > 1 %}
          <div class="lux-search__pagination">
            {{ paginate | default_pagination }}
          </div>
        {% endif %}
      {% endpaginate %}

    {% else %}
      <div class="lux-search__no-results">
        <p class="lux-search__no-results-title">No results for "{{ search.terms | escape }}"</p>
        <p class="lux-search__no-results-text">Try a different keyword or check your spelling.</p>
      </div>
    {% endif %}

  {% else %}
    <div class="lux-search__empty">
      <svg class="lux-search__empty-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
      <p class="lux-search__empty-title">Discover our collection</p>
      <p class="lux-search__empty-text">Search by product name, category, or keyword to find exactly what you're looking for.</p>
    </div>
  {% endif %}
  </div>

</div>

<script>
(function() {
  var input = document.getElementById('lux-input');
  var live = document.getElementById('lux-live');
  var staticResults = document.getElementById('lux-static-results');
  var clearBtn = document.getElementById('lux-clear');
  var timer = null;
  var lastQuery = '';

  function escapeHtml(text) {
    if (!text) return '';
    var el = document.createElement('span');
    el.textContent = text;
    return el.innerHTML;
  }

  function getRootUrl() {
    return (window.Shopify && window.Shopify.routes && window.Shopify.routes.root) || '/';
  }

  function showLive() {
    live.classList.add('is-open');
    staticResults.style.display = 'none';
  }

  function hideLive() {
    live.classList.remove('is-open');
    setTimeout(function() {
      if (!live.classList.contains('is-open')) {
        live.innerHTML = '';
        staticResults.style.display = '';
      }
    }, 350);
  }

  function updateClearBtn() {
    if (input.value.length > 0) {
      clearBtn.classList.add('is-visible');
    } else {
      clearBtn.classList.remove('is-visible');
    }
  }

  updateClearBtn();

  clearBtn.addEventListener('click', function() {
    input.value = '';
    updateClearBtn();
    hideLive();
    lastQuery = '';
    input.focus();
  });

  input.addEventListener('input', function() {
    clearTimeout(timer);
    updateClearBtn();

    var query = input.value.trim();

    if (query.length === 0) {
      hideLive();
      lastQuery = '';
      return;
    }

    showLive();
    live.innerHTML = '<div class="lux-live__status"><span class="lux-live__spinner"></span>Searching\u2026</div>';

    timer = setTimeout(function() {
      lastQuery = query;
      var root = getRootUrl().replace(/\/$/, '');
      var url = root + '/search/suggest.json?q=' + encodeURIComponent(query) + '&resources[type]=product&resources[limit]=6';

      fetch(url)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          if (input.value.trim() !== lastQuery) return;

          var products = (data.resources && data.resources.results && data.resources.results.products) || [];

          if (products.length === 0) {
            live.innerHTML = '<div class="lux-live__status" style="color:#555;">No products found for \u201C' + escapeHtml(query) + '\u201D</div>';
            return;
          }

          var html = '<p class="lux-live__heading">Results for \u201C' + escapeHtml(query) + '\u201D</p>';
          html += '<div class="lux-live__grid">';

          products.forEach(function(p) {
            var title = escapeHtml(p.title);
            var price = escapeHtml(p.price || '');
            var href = (p.url || '').replace(/"/g, '&quot;');
            var img = (p.image || '').replace(/"/g, '&quot;');

            html += '<a href="' + href + '" class="lux-live__card">';
            html += '<div class="lux-live__card-img">';
            if (p.image) {
              html += '<img src="' + img + '" alt="' + title + '" width="300" height="300" loading="lazy">';
            }
            html += '</div>';
            html += '<div class="lux-live__card-body">';
            html += '<div class="lux-live__card-title">' + title + '</div>';
            if (price) {
              html += '<div class="lux-live__card-price">' + price + '</div>';
            }
            html += '</div></a>';
          });

          html += '</div>';
          html += '<a href="' + root + '/search?q=' + encodeURIComponent(query) + '&type=product" class="lux-live__view-all">View All Results</a>';

          live.innerHTML = html;
        })
        .catch(function() {
          live.innerHTML = '<div class="lux-live__status" style="color:#555;">Something went wrong. Try again.</div>';
        });
    }, 300);
  });

  input.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      hideLive();
      input.blur();
    }
  });
})();
</script>

{% schema %}
{
  "name": "Luxury Search",
  "settings": [
    {
      "type": "text",
      "id": "placeholder_text",
      "label": "Placeholder Text",
      "default": "Search exclusive collections\u2026"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Gold Border Color",
      "default": "#C6A75E"
    },
    {
      "type": "range",
      "id": "bg_opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "label": "Background Opacity",
      "default": 0.9
    },
    {
      "type": "checkbox",
      "id": "enable_animation",
      "label": "Enable Border Shimmer",
      "default": true,
      "info": "Animated gold shimmer on the border when the input is focused."
    }
  ],
  "presets": [
    {
      "name": "Luxury Search"
    }
  ]
}
{% endschema %}
